---
// src/pages/productos/[slug]/index.astro
import Layout from '../../../layouts/Layout.astro';
import { catalogProducts, getProductBySlug, type CatalogProduct } from '../../../data/catalog';

export async function getStaticPaths() {
  return catalogProducts
    .filter(p => p.isActive)
    .map((product) => ({
      params: { slug: product.slug },
      props: { product }
    }));
}

interface Props {
  product: CatalogProduct;
}

const { product } = Astro.props;

// Imágenes por producto
const productImages: Record<string, string[]> = {
  'cesped-artificial-greendis-7mm': ['/cesped-1.jpg', '/cesped-natural.webp', '/contrasting-outdoor-texture-design.jpg'],
  'cesped-artificial-summer-8mm': ['/cesped-artifical-2.png', '/cesped-1.jpg', '/cesped-natural.webp'],
  'cesped-artificial-capridis-8mm': ['/contrasting-outdoor-texture-design.jpg', '/cesped-artifical-2.png', '/cesped-1.jpg'],
  'cesped-artificial-summer-18mm': ['/cesped-natural.webp', '/cesped-1.jpg', '/cesped-artifical-2.png'],
  'cesped-artificial-bredis-30mm': ['/cesped-1.jpg', '/contrasting-outdoor-texture-design.jpg', '/cesped-natural.webp'],
};

const images = productImages[product.slug] || ['/cesped-1.jpg', '/cesped-natural.webp', '/contrasting-outdoor-texture-design.jpg'];

// Productos relacionados (misma categoría, excluyendo el actual)
const relatedProducts = catalogProducts
  .filter(p => p.isActive && p.category === product.category && p.id !== product.id)
  .slice(0, 3);

// Si no hay suficientes de la misma categoría, añadir de otras
const otherProducts = relatedProducts.length < 3 
  ? catalogProducts.filter(p => p.isActive && p.id !== product.id && !relatedProducts.includes(p)).slice(0, 3 - relatedProducts.length)
  : [];

const allRelated = [...relatedProducts, ...otherProducts];

const pageTitle = product.metaTitle;
const pageDescription = product.metaDescription;

// Calcular precio del rollo
const rollPriceMin = product.rollFormat.totalSqm * product.priceMin;
const rollPriceMax = product.rollFormat.totalSqm * product.priceMax;

// Iconos de categoría como SVG
const categoryIcons: Record<string, string> = {
  decorativo: `<svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.53 16.122a3 3 0 0 0-5.78 1.128 2.25 2.25 0 0 1-2.4 2.245 4.5 4.5 0 0 0 8.4-2.245c0-.399-.078-.78-.22-1.128Zm0 0a15.998 15.998 0 0 0 3.388-1.62m-5.043-.025a15.994 15.994 0 0 1 1.622-3.395m3.42 3.42a15.995 15.995 0 0 0 4.764-4.648l3.876-5.814a1.151 1.151 0 0 0-1.597-1.597L14.146 6.32a15.996 15.996 0 0 0-4.649 4.763m3.42 3.42a6.776 6.776 0 0 0-3.42-3.42" /></svg>`,
  residencial: `<svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" /></svg>`,
  premium: `<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>`,
  deportivo: `<svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 12m-9 0a9 9 0 1 0 18 0 9 9 0 1 0-18 0M12 3v18M3 12h18M5.6 5.6l12.8 12.8M18.4 5.6L5.6 18.4" /></svg>`
};
---

<Layout title={pageTitle}>

  <!-- Breadcrumbs -->
  <nav class="bg-white border-b border-gray-100">
    <div class="max-w-7xl mx-auto px-4 py-4">
      <ol class="flex items-center gap-2 text-sm">
        <li>
          <a href="/" class="text-slate-500 hover:text-green-600 transition flex items-center gap-1">
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
            </svg>
            Inicio
          </a>
        </li>
        <li><svg class="w-4 h-4 text-slate-300" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" /></svg></li>
        <li><a href="/productos" class="text-slate-500 hover:text-green-600 transition">Productos</a></li>
        <li><svg class="w-4 h-4 text-slate-300" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" /></svg></li>
        <li class="text-slate-900 font-semibold">{product.shortName}</li>
      </ol>
    </div>
  </nav>

  <main class="bg-slate-50">

    <!-- Hero del producto -->
    <section class="bg-white">
      <div class="max-w-7xl mx-auto px-4 py-8 md:py-12">
        <div class="grid lg:grid-cols-2 gap-8 lg:gap-16">
          
          <!-- Galería de imágenes -->
          <div class="space-y-4">
            <!-- Imagen principal -->
            <div class="relative aspect-[4/3] bg-gradient-to-br from-green-50 to-emerald-100 rounded-3xl overflow-hidden group">
              <img 
                id="main-image"
                src={images[0]}
                alt={`Césped artificial ${product.shortName}`}
                class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
              />
              
              <!-- Overlay gradient -->
              <div class="absolute inset-0 bg-gradient-to-t from-black/30 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
              
              <!-- Badges -->
              <div class="absolute top-4 left-4 flex flex-wrap gap-2">
                {product.isFeatured && (
                  <span class="bg-gradient-to-r from-amber-500 to-orange-500 text-white text-xs font-bold px-4 py-2 rounded-full uppercase shadow-lg shadow-amber-500/30 flex items-center gap-1.5">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
                    Popular
                  </span>
                )}
                {product.isNew && (
                  <span class="bg-gradient-to-r from-blue-500 to-cyan-500 text-white text-xs font-bold px-4 py-2 rounded-full uppercase shadow-lg shadow-blue-500/30">
                    Nuevo
                  </span>
                )}
              </div>

              <!-- Altura destacada -->
              <div class="absolute bottom-4 right-4">
                <div class="bg-white/95 backdrop-blur-sm rounded-2xl px-5 py-3 shadow-xl">
                  <span class="text-3xl font-black text-green-600">{product.height}</span>
                  <span class="text-lg font-bold text-slate-500">mm</span>
                </div>
              </div>
            </div>

            <!-- Miniaturas -->
            <div class="grid grid-cols-3 gap-3">
              {images.map((img, index) => (
                <button 
                  class={`thumbnail-btn aspect-[4/3] rounded-xl overflow-hidden border-2 transition-all hover:opacity-100 ${index === 0 ? 'border-green-500 opacity-100' : 'border-transparent opacity-60'}`}
                  data-image={img}
                >
                  <img 
                    src={img}
                    alt={`Vista ${index + 1}`}
                    class="w-full h-full object-cover"
                  />
                </button>
              ))}
            </div>
          </div>

          <!-- Info del producto -->
          <div class="lg:py-4">
            <!-- Categoría y nombre -->
            <div class="mb-6">
              <div class="flex items-center gap-2 mb-3">
                <span class="inline-flex items-center gap-1.5 bg-slate-100 text-slate-600 text-xs font-bold px-3 py-1.5 rounded-full uppercase">
                  <Fragment set:html={categoryIcons[product.category]} />
                  {product.category}
                </span>
                <span class="text-slate-300">•</span>
                <span class="text-sm text-slate-500">{product.height}mm de altura</span>
              </div>
              <h1 class="text-3xl md:text-4xl lg:text-5xl font-black text-slate-900 mb-4 leading-tight">
                {product.name}
              </h1>
              <p class="text-lg text-slate-600 leading-relaxed">
                {product.headline}
              </p>
            </div>

            <!-- Precio destacado -->
            <div class="bg-gradient-to-br from-green-50 to-emerald-50 border border-green-200 rounded-2xl p-6 mb-6">
              <div class="flex items-baseline gap-1 mb-1">
                <span class="text-sm text-slate-500">Desde</span>
              </div>
              <div class="flex items-baseline gap-2 mb-3">
                <span class="text-5xl font-black text-green-600">{product.priceMin}€</span>
                <span class="text-xl text-slate-400">/m²</span>
                {product.priceMin !== product.priceMax && (
                  <span class="text-lg text-slate-400 ml-2">hasta {product.priceMax}€/m²</span>
                )}
              </div>
              <div class="flex items-center gap-4 text-sm">
                <span class="text-slate-600">
                  <span class="font-semibold">Rollo completo:</span> {product.rollFormat.totalSqm}m² = {rollPriceMin.toFixed(0)}€
                  {rollPriceMin !== rollPriceMax && ` - ${rollPriceMax.toFixed(0)}€`}
                </span>
              </div>
            </div>

            <!-- Colores disponibles -->
            {product.variants.length > 1 && (
              <div class="mb-6">
                <h3 class="text-sm font-bold text-slate-700 uppercase tracking-wider mb-3">
                  Colores disponibles ({product.variants.length})
                </h3>
                <div class="flex flex-wrap gap-2">
                  {product.variants.map((variant, index) => (
                    <button 
                      class={`color-btn flex items-center gap-2 px-4 py-2.5 rounded-xl border-2 transition-all ${index === 0 ? 'border-green-500 bg-green-50' : 'border-slate-200 hover:border-slate-300 bg-white'}`}
                      data-price={variant.pricePerSqm}
                    >
                      <span 
                        class="w-6 h-6 rounded-full border-2 border-white shadow-sm shrink-0" 
                        style={`background-color: ${variant.colorHex || '#4a7c59'}`}
                      />
                      <span class="font-medium text-slate-700">{variant.color}</span>
                      <span class="text-sm text-slate-400">{variant.pricePerSqm}€</span>
                    </button>
                  ))}
                </div>
              </div>
            )}

            <!-- Formato del rollo -->
            <div class="grid grid-cols-3 gap-3 mb-6">
              <div class="bg-white border border-slate-200 rounded-xl p-4 text-center hover:border-green-300 hover:shadow-md transition-all">
                <div class="w-10 h-10 bg-slate-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                  <svg class="w-5 h-5 text-slate-600" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15" />
                  </svg>
                </div>
                <span class="block text-2xl font-black text-slate-900">{product.rollFormat.length}m</span>
                <span class="text-xs text-slate-500 font-medium">Largo</span>
              </div>
              <div class="bg-white border border-slate-200 rounded-xl p-4 text-center hover:border-green-300 hover:shadow-md transition-all">
                <div class="w-10 h-10 bg-slate-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                  <svg class="w-5 h-5 text-slate-600" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M7.5 21 3 16.5m0 0L7.5 12M3 16.5h13.5m0-13.5L21 7.5m0 0L16.5 12M21 7.5H7.5" />
                  </svg>
                </div>
                <span class="block text-2xl font-black text-slate-900">{product.rollFormat.width}m</span>
                <span class="text-xs text-slate-500 font-medium">Ancho</span>
              </div>
              <div class="bg-white border border-slate-200 rounded-xl p-4 text-center hover:border-green-300 hover:shadow-md transition-all">
                <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                  <svg class="w-5 h-5 text-green-600" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 0 1 6 3.75h2.25A2.25 2.25 0 0 1 10.5 6v2.25a2.25 2.25 0 0 1-2.25 2.25H6a2.25 2.25 0 0 1-2.25-2.25V6ZM3.75 15.75A2.25 2.25 0 0 1 6 13.5h2.25a2.25 2.25 0 0 1 2.25 2.25V18a2.25 2.25 0 0 1-2.25 2.25H6A2.25 2.25 0 0 1 3.75 18v-2.25ZM13.5 6a2.25 2.25 0 0 1 2.25-2.25H18A2.25 2.25 0 0 1 20.25 6v2.25A2.25 2.25 0 0 1 18 10.5h-2.25a2.25 2.25 0 0 1-2.25-2.25V6ZM13.5 15.75a2.25 2.25 0 0 1 2.25-2.25H18a2.25 2.25 0 0 1 2.25 2.25V18A2.25 2.25 0 0 1 18 20.25h-2.25A2.25 2.25 0 0 1 13.5 18v-2.25Z" />
                  </svg>
                </div>
                <span class="block text-2xl font-black text-green-600">{product.rollFormat.totalSqm}m²</span>
                <span class="text-xs text-slate-500 font-medium">Por rollo</span>
              </div>
            </div>

            <!-- Características rápidas -->
            <div class="flex flex-wrap gap-2 mb-6">
              {product.uvProtection && (
                <span class="inline-flex items-center gap-1.5 bg-amber-50 text-amber-700 text-sm font-semibold px-4 py-2 rounded-xl border border-amber-200">
                  <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z" />
                  </svg>
                  Anti-UV
                </span>
              )}
              {product.drainageSystem && (
                <span class="inline-flex items-center gap-1.5 bg-blue-50 text-blue-700 text-sm font-semibold px-4 py-2 rounded-xl border border-blue-200">
                  <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m0 13.5V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636" />
                  </svg>
                  Drenaje
                </span>
              )}
              {product.petFriendly && (
                <span class="inline-flex items-center gap-1.5 bg-green-50 text-green-700 text-sm font-semibold px-4 py-2 rounded-xl border border-green-200">
                  <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6.633 10.25c.806 0 1.533-.446 2.031-1.08a9.041 9.041 0 0 1 2.861-2.4c.723-.384 1.35-.956 1.653-1.715a4.498 4.498 0 0 0 .322-1.672V2.75a.75.75 0 0 1 .75-.75 2.25 2.25 0 0 1 2.25 2.25c0 1.152-.26 2.243-.723 3.218-.266.558.107 1.282.725 1.282m0 0h3.126c1.026 0 1.945.694 2.054 1.715.045.422.068.85.068 1.285a11.95 11.95 0 0 1-2.649 7.521c-.388.482-.987.729-1.605.729H13.48c-.483 0-.964-.078-1.423-.23l-3.114-1.04a4.501 4.501 0 0 0-1.423-.23H5.904m10.598-9.75H14.25M5.904 18.5c.083.205.173.405.27.602.197.4-.078.898-.523.898h-.908c-.889 0-1.713-.518-1.972-1.368a12 12 0 0 1-.521-3.507c0-1.553.295-3.036.831-4.398C3.387 9.953 4.167 9.5 5 9.5h1.053c.472 0 .745.556.5.96a8.958 8.958 0 0 0-1.302 4.665c0 1.194.232 2.333.654 3.375Z" />
                  </svg>
                  Pet Friendly
                </span>
              )}
              {product.childSafe && (
                <span class="inline-flex items-center gap-1.5 bg-purple-50 text-purple-700 text-sm font-semibold px-4 py-2 rounded-xl border border-purple-200">
                  <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.182 15.182a4.5 4.5 0 0 1-6.364 0M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0ZM9.75 9.75c0 .414-.168.75-.375.75S9 10.164 9 9.75 9.168 9 9.375 9s.375.336.375.75Zm-.375 0h.008v.015h-.008V9.75Zm5.625 0c0 .414-.168.75-.375.75s-.375-.336-.375-.75.168-.75.375-.75.375.336.375.75Zm-.375 0h.008v.015h-.008V9.75Z" />
                  </svg>
                  Apto niños
                </span>
              )}
              {product.fireRetardant && (
                <span class="inline-flex items-center gap-1.5 bg-red-50 text-red-700 text-sm font-semibold px-4 py-2 rounded-xl border border-red-200">
                  <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.362 5.214A8.252 8.252 0 0 1 12 21 8.25 8.25 0 0 1 6.038 7.047 8.287 8.287 0 0 0 9 9.601a8.983 8.983 0 0 1 3.361-6.867 8.21 8.21 0 0 0 3 2.48Z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 18a3.75 3.75 0 0 0 .495-7.468 5.99 5.99 0 0 0-1.925 3.547 5.975 5.975 0 0 1-2.133-1.001A3.75 3.75 0 0 0 12 18Z" />
                  </svg>
                  Ignífugo
                </span>
              )}
            </div>

            <!-- Garantía -->
            <div class="flex items-center gap-4 bg-slate-900 text-white rounded-2xl p-5 mb-6">
              <div class="w-14 h-14 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl flex items-center justify-center shrink-0 shadow-lg shadow-green-900/30">
                <svg class="w-7 h-7" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75m-3-7.036A11.959 11.959 0 0 1 3.598 6 11.99 11.99 0 0 0 3 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285Z" />
                </svg>
              </div>
              <div>
                <p class="font-black text-xl">{product.warranty} años de garantía</p>
                <p class="text-sm text-slate-400">Garantía de fábrica incluida en todos los pedidos</p>
              </div>
            </div>

            <!-- CTAs -->
            <div class="flex flex-col sm:flex-row gap-3">
              <a 
                href="tel:934850085" 
                class="flex-1 inline-flex items-center justify-center gap-2 bg-gradient-to-r from-green-600 to-emerald-600 text-white px-6 py-4 rounded-xl font-bold hover:from-green-500 hover:to-emerald-500 transition-all shadow-lg shadow-green-600/30 text-lg"
              >
                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 0 0 2.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 0 1-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 0 0-1.091-.852H4.5A2.25 2.25 0 0 0 2.25 4.5v2.25Z" />
                </svg>
                934 850 085
              </a>
              <a 
                href="mailto:ventas@disstands.com" 
                class="flex-1 inline-flex items-center justify-center gap-2 bg-slate-900 text-white px-6 py-4 rounded-xl font-bold hover:bg-slate-800 transition-all"
              >
                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25m19.5 0v.243a2.25 2.25 0 0 1-1.07 1.916l-7.5 4.615a2.25 2.25 0 0 1-2.36 0L3.32 8.91a2.25 2.25 0 0 1-1.07-1.916V6.75" />
                </svg>
                Pedir presupuesto
              </a>
            </div>

            <!-- Info corte a medida -->
            {product.customCutAvailable && (
              <div class="mt-4 p-4 bg-amber-50 border border-amber-200 rounded-xl flex items-start gap-3">
                <svg class="w-5 h-5 text-amber-600 shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="m7.848 8.25 1.536.887M7.848 8.25a3 3 0 1 1-5.196-3 3 3 0 0 1 5.196 3Zm1.536.887a2.165 2.165 0 0 1 1.083 1.839c.005.351.054.695.14 1.024M9.384 9.137l2.077 1.199M7.848 15.75l1.536-.887m-1.536.887a3 3 0 1 1-5.196 3 3 3 0 0 1 5.196-3Zm1.536-.887a2.165 2.165 0 0 0 1.083-1.838c.005-.352.054-.695.14-1.025m-1.223 2.863 2.077-1.199m0-3.328a4.323 4.323 0 0 1 2.068-1.379l5.325-1.628a4.5 4.5 0 0 1 2.48-.044l.803.215-7.794 4.5m-2.882-1.664A4.33 4.33 0 0 0 10.607 12m3.736 0 7.794 4.5-.802.215a4.5 4.5 0 0 1-2.48-.043l-5.326-1.629a4.324 4.324 0 0 1-2.068-1.379M14.343 12l-2.882 1.664" />
                </svg>
                <div>
                  <p class="font-bold text-amber-800">Corte a medida disponible</p>
                  <p class="text-sm text-amber-700">
                    {!product.customCutReturnable ? 'Los cortes personalizados no admiten devolución.' : 'Te cortamos la cantidad exacta que necesitas.'}
                  </p>
                </div>
              </div>
            )}
          </div>
        </div>
      </div>
    </section>

    <!-- Contenido adicional -->
    <div class="max-w-7xl mx-auto px-4 py-12 md:py-16">

      <!-- Descripción y características -->
      <section class="grid lg:grid-cols-3 gap-8 mb-16">
        
        <!-- Descripción -->
        <div class="lg:col-span-2">
          <div class="bg-white rounded-2xl p-8 shadow-sm border border-slate-100">
            <h2 class="text-2xl font-black text-slate-900 mb-6 flex items-center gap-3">
              <span class="w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center">
                <svg class="w-5 h-5 text-green-600" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" />
                </svg>
              </span>
              Descripción
            </h2>
            <p class="text-lg text-slate-600 leading-relaxed mb-8">
              {product.description}
            </p>

            <!-- Características -->
            <h3 class="text-lg font-bold text-slate-900 mb-4">Características destacadas</h3>
            <div class="grid sm:grid-cols-2 gap-3">
              {product.features.map((feature) => (
                <div class="flex items-start gap-3 bg-slate-50 rounded-xl p-4">
                  <div class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center shrink-0 mt-0.5">
                    <svg class="w-4 h-4 text-white" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
                    </svg>
                  </div>
                  <span class="text-slate-700">{feature}</span>
                </div>
              ))}
            </div>
          </div>
        </div>

        <!-- Aplicaciones -->
        <div>
          <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-100 sticky top-24">
            <h2 class="text-xl font-bold text-slate-900 mb-4 flex items-center gap-2">
              <span class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center">
                <svg class="w-4 h-4 text-blue-600" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25ZM6.75 12h.008v.008H6.75V12Zm0 3h.008v.008H6.75V15Zm0 3h.008v.008H6.75V18Z" />
                </svg>
              </span>
              Ideal para
            </h2>
            <ul class="space-y-2">
              {product.applications.map((application) => (
                <li class="flex items-center gap-2 text-slate-600 py-2 border-b border-slate-100 last:border-0">
                  <svg class="w-4 h-4 text-blue-500 shrink-0" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" />
                  </svg>
                  {application}
                </li>
              ))}
            </ul>

            <!-- Tags -->
            <div class="mt-6 pt-6 border-t border-slate-200">
              <h3 class="text-sm font-bold text-slate-500 uppercase tracking-wider mb-3">Etiquetas</h3>
              <div class="flex flex-wrap gap-2">
                {product.tags.map((tag) => (
                  <span class="bg-slate-100 text-slate-600 px-3 py-1.5 rounded-lg text-sm">
                    {tag}
                  </span>
                ))}
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="mb-20">
        <div class="flex items-center gap-4 mb-8">
          <span class="w-12 h-12 bg-green-100 text-green-600 rounded-2xl flex items-center justify-center shadow-sm">
            <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6a7.5 7.5 0 1 0 7.5 7.5h-7.5V6Z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 10.5H21A7.5 7.5 0 0 0 13.5 3v7.5Z" />
            </svg>            
          </span>
          <div>
            <h2 class="text-3xl font-black text-slate-900 tracking-tight">Ficha Técnica</h2>
            <p class="text-slate-500 text-sm font-medium">Detalles y composición del producto</p>
          </div>
        </div>
      
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
          
          {product.specs.map((spec) => (
            <div class="group bg-slate-50 hover:bg-white border border-slate-100 hover:border-green-200 rounded-2xl p-5 transition-all duration-300 hover:shadow-lg hover:shadow-green-900/5">
              <div class="flex items-start justify-between mb-2">
                <span class="text-xs font-bold text-slate-400 uppercase tracking-wider">{spec.label}</span>
                <svg class="w-4 h-4 text-green-500/50 group-hover:text-green-500 transition-colors" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M6 13.5V3.75m0 9.75a1.5 1.5 0 0 1 0 3m0-3a1.5 1.5 0 0 0 0 3m0 3.75V16.5m12-3V3.75m0 9.75a1.5 1.5 0 0 1 0 3m0-3a1.5 1.5 0 0 0 0 3m0 3.75V16.5m-6-9V3.75m0 3.75a1.5 1.5 0 0 1 0 3m0-3a1.5 1.5 0 0 0 0 3m0 9.75V10.5" />
                </svg>
              </div>
              <span class="text-lg md:text-xl font-bold text-slate-900 block truncate" title={spec.value}>
                {spec.value}
              </span>
            </div>
          ))}
      
          <div class="bg-slate-50 hover:bg-white border border-slate-100 hover:border-green-200 rounded-2xl p-5 transition-all duration-300 hover:shadow-lg hover:shadow-green-900/5">
            <div class="flex items-start justify-between mb-2">
              <span class="text-xs font-bold text-slate-400 uppercase tracking-wider">Material Fibra</span>
              <svg class="w-4 h-4 text-green-500/50" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21 7.5l-9-5.25L3 7.5m18 0l-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9" />
              </svg>
            </div>
            <span class="text-lg md:text-xl font-bold text-slate-900 block leading-tight">
              {product.material}
            </span>
          </div>
      
          <div class="bg-slate-50 hover:bg-white border border-slate-100 hover:border-green-200 rounded-2xl p-5 transition-all duration-300 hover:shadow-lg hover:shadow-green-900/5">
            <div class="flex items-start justify-between mb-2">
              <span class="text-xs font-bold text-slate-400 uppercase tracking-wider">Base / Backing</span>
              <svg class="w-4 h-4 text-green-500/50" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19 14c1.49-1.208 3-1.218 3-2.069 0-1.02-3.813-1.85-8.5-1.85-4.688 0-8.5.83-8.5 1.85 0 .85 1.51 1.25 3 2.069" />
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 18c4.687 0 8.5-.83 8.5-1.85 0-.814-1.26-1.135-2.5-1.85" />
                <path stroke-linecap="round" stroke-linejoin="round" d="M6.5 14.319C5.26 15.014 4 15.335 4 16.15 4 17.169 7.813 18 12.5 18s8.5-.831 8.5-1.85c0-.815-1.26-1.136-2.5-1.85" />
              </svg>
            </div>
            <span class="text-lg md:text-xl font-bold text-slate-900 block leading-tight">
              {product.backing}
            </span>
          </div>
      
          <div class="bg-green-50 border border-green-100 rounded-2xl p-5 hover:shadow-lg hover:shadow-green-500/10 transition-all duration-300">
            <div class="flex items-start justify-between mb-2">
              <span class="text-xs font-bold text-green-700 uppercase tracking-wider">Garantía Fab.</span>
              <svg class="w-5 h-5 text-green-600" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 0 1-1.043 3.296 3.745 3.745 0 0 1-3.296 1.043A3.745 3.745 0 0 1 12 21c-1.268 0-2.39-.63-3.068-1.593a3.746 3.746 0 0 1-3.296-1.043 3.745 3.745 0 0 1-1.043-3.296A3.745 3.745 0 0 1 3 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 0 1 1.043-3.296 3.746 3.746 0 0 1 3.296-1.043A3.746 3.746 0 0 1 12 3c1.268 0 2.39.63 3.068 1.593a3.746 3.746 0 0 1 3.296 1.043 3.746 3.746 0 0 1 1.043 3.296A3.745 3.745 0 0 1 21 12Z" />
              </svg>
            </div>
            <span class="text-2xl font-black text-green-700 block">
              {product.warranty} Años
            </span>
          </div>
      
        </div>
      </section>

      <!-- Productos relacionados -->
      {allRelated.length > 0 && (
        <section class="mb-16">
          <h2 class="text-2xl font-black text-slate-900 mb-6">También te puede interesar</h2>
          <div class="grid md:grid-cols-3 gap-6">
            {allRelated.map((related) => (
              <a 
                href={`/productos/${related.slug}`}
                class="group bg-white border border-slate-200 rounded-2xl overflow-hidden hover:shadow-xl hover:border-green-300 transition-all duration-300"
              >
                <div class="relative h-40 bg-gradient-to-br from-green-50 to-emerald-100 overflow-hidden">
                  <img 
                    src={productImages[related.slug]?.[0] || '/cesped-1.jpg'}
                    alt={related.shortName}
                    class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                  />
                  <div class="absolute bottom-3 right-3 bg-white/95 backdrop-blur rounded-lg px-3 py-1">
                    <span class="text-lg font-black text-green-600">{related.height}mm</span>
                  </div>
                </div>
                <div class="p-5">
                  <span class="inline-flex items-center gap-1 text-xs font-bold text-slate-400 uppercase">
                    <Fragment set:html={categoryIcons[related.category]} />
                    {related.category}
                  </span>
                  <h3 class="font-bold text-lg text-slate-900 group-hover:text-green-600 transition mt-1 mb-2">
                    {related.shortName}
                  </h3>
                  <div class="flex items-baseline gap-1">
                    <span class="text-2xl font-black text-green-600">{related.priceMin}€</span>
                    <span class="text-slate-400">/m²</span>
                  </div>
                </div>
              </a>
            ))}
          </div>
        </section>
      )}

      <!-- CTA Final -->
      <section class="relative bg-slate-900 rounded-3xl p-8 md:p-12 text-center overflow-hidden">
        <div class="absolute inset-0 opacity-10">
          <img src={images[0]} alt="" class="w-full h-full object-cover" />
        </div>
        <div class="relative z-10">
          <h2 class="text-2xl md:text-4xl font-black text-white mb-4">
            ¿Interesado en {product.shortName}?
          </h2>
          <p class="text-slate-300 mb-8 max-w-xl mx-auto text-lg">
            Solicita presupuesto sin compromiso. Te asesoramos sobre medidas, instalación y el mejor formato para tu proyecto.
          </p>
          <div class="flex flex-wrap justify-center gap-4">
            <a href="tel:934850085" class="inline-flex items-center gap-2 bg-gradient-to-r from-green-600 to-emerald-600 text-white px-8 py-4 rounded-xl font-bold hover:from-green-500 hover:to-emerald-500 transition shadow-lg shadow-green-900/30">
              <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 0 0 2.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 0 1-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 0 0-1.091-.852H4.5A2.25 2.25 0 0 0 2.25 4.5v2.25Z" />
              </svg>
              Llamar ahora
            </a>
            <a href={`mailto:ventas@disstands.com?subject=Presupuesto%20${product.shortName}`} class="inline-flex items-center gap-2 bg-white text-slate-900 px-8 py-4 rounded-xl font-bold hover:bg-slate-100 transition">
              <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25m19.5 0v.243a2.25 2.25 0 0 1-1.07 1.916l-7.5 4.615a2.25 2.25 0 0 1-2.36 0L3.32 8.91a2.25 2.25 0 0 1-1.07-1.916V6.75" />
              </svg>
              Enviar email
            </a>
          </div>
        </div>
      </section>

    </div>
  </main>

  <!-- Script para galería y colores -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Galería de imágenes
      const mainImage = document.getElementById('main-image') as HTMLImageElement;
      const thumbnails = document.querySelectorAll('.thumbnail-btn');

      thumbnails.forEach(thumb => {
        thumb.addEventListener('click', () => {
          const newSrc = thumb.getAttribute('data-image');
          if (mainImage && newSrc) {
            mainImage.src = newSrc;
            mainImage.style.opacity = '0';
            setTimeout(() => {
              mainImage.style.opacity = '1';
            }, 50);
          }

          // Actualizar estilos de miniaturas
          thumbnails.forEach(t => {
            t.classList.remove('border-green-500', 'opacity-100');
            t.classList.add('border-transparent', 'opacity-60');
          });
          thumb.classList.remove('border-transparent', 'opacity-60');
          thumb.classList.add('border-green-500', 'opacity-100');
        });
      });

      // Selector de colores
      const colorBtns = document.querySelectorAll('.color-btn');
      colorBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          colorBtns.forEach(b => {
            b.classList.remove('border-green-500', 'bg-green-50');
            b.classList.add('border-slate-200', 'bg-white');
          });
          btn.classList.remove('border-slate-200', 'bg-white');
          btn.classList.add('border-green-500', 'bg-green-50');
        });
      });
    });
  </script>

  <style>
    #main-image {
      transition: opacity 0.2s ease-out;
    }
  </style>

  <!-- Schema markup -->
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "Product",
    "name": product.name,
    "description": product.description,
    "image": images.map(img => `https://cespedbcn.com${img}`),
    "brand": {
      "@type": "Brand",
      "name": "CespedBCN"
    },
    "offers": {
      "@type": "AggregateOffer",
      "lowPrice": product.priceMin,
      "highPrice": product.priceMax,
      "priceCurrency": "EUR",
      "unitText": "m²",
      "availability": "https://schema.org/InStock",
      "seller": {
        "@type": "Organization",
        "name": "CespedBCN",
        "telephone": "+34934850085"
      }
    },
    "aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": "4.8",
      "reviewCount": "47"
    },
    "additionalProperty": [
      {
        "@type": "PropertyValue",
        "name": "Altura de fibra",
        "value": `${product.height}mm`
      },
      {
        "@type": "PropertyValue",
        "name": "Garantía",
        "value": `${product.warranty} años`
      }
    ]
  })} />

</Layout>