---
// src/pages/servicios/[tipo]/index.astro
import Layout from '../../../layouts/Layout.astro';
import { productData, type ProductCategory } from '../../../data/products';
import { barcelonaLocations } from '../../../data/locations';
export async function getStaticPaths() {
  const tipos: ProductCategory[] = [
    'deportivo',
    'piscinas', 
    'eventos',
    'comercial',
    'residencial-terraza',
    'residencial-jardin',
    'institucional',
    'terraza',
    'jardin',
    'funcional'
  ];

  return tipos.map((tipo) => ({
    params: { tipo },
    props: { 
      tipo,
      product: productData[tipo]
    }
  }));
}

const { tipo, product } = Astro.props;

// Obtener barrios que usan este tipo de servicio
const barriosConEsteTipo = barcelonaLocations.flatMap(distrito => 
  distrito.barrios
    .filter(barrio => barrio.type === tipo)
    .map(barrio => ({
      ...barrio,
      distritoSlug: distrito.slug,
      distritoName: distrito.name
    }))
);

// Agrupar por distrito para mostrar
const barriosPorDistrito = barcelonaLocations
  .map(distrito => ({
    ...distrito,
    barriosFiltrados: distrito.barrios.filter(b => b.type === tipo)
  }))
  .filter(d => d.barriosFiltrados.length > 0);

const pageTitle = `${product.title} en Barcelona | CespedBCN`;
const pageDescription = `${product.description.slice(0, 150)}... Presupuesto gratis. Garantía ${product.technicalSpecs.garantiaFabrica}.`;

// Formatear precio
const formatPrice = (price: number) => `${price}€/m²`;
---

<Layout title={pageTitle}>

  <!-- Breadcrumbs -->
  <nav class="bg-gray-50 border-b border-gray-200">
    <div class="max-w-6xl mx-auto px-4 py-3">
      <ol class="flex items-center gap-2 text-sm text-gray-600">
        <li><a href="/" class="hover:text-green-600 transition">Inicio</a></li>
        <li><span class="text-gray-400">/</span></li>
        <li><a href="/servicios" class="hover:text-green-600 transition">Servicios</a></li>
        <li><span class="text-gray-400">/</span></li>
        <li class="text-gray-900 font-medium">{product.title}</li>
      </ol>
    </div>
  </nav>

  <!-- Hero -->
  <header class="bg-slate-900 text-white py-16 md:py-24">
    <div class="max-w-6xl mx-auto px-4">
      <div class="max-w-3xl">
        <span class="inline-block bg-green-600 text-white text-xs font-bold px-3 py-1 rounded-full mb-4 uppercase tracking-wider">
          Servicio Especializado
        </span>
        <h1 class="text-4xl md:text-5xl font-black mb-4">
          {product.title}
        </h1>
        <p class="text-xl text-slate-300 mb-8">
          {product.subtitle}
        </p>
        
        <div class="flex flex-wrap gap-4 mb-8">
          <div class="bg-white/10 backdrop-blur rounded-xl px-4 py-3 border border-white/20">
            <span class="block text-2xl font-bold text-green-400">
              {formatPrice(product.pricing.basePrice)} - {formatPrice(product.pricing.premiumPrice)}
            </span>
            <span class="text-sm text-slate-400">Precio material</span>
          </div>
          <div class="bg-white/10 backdrop-blur rounded-xl px-4 py-3 border border-white/20">
            <span class="block text-2xl font-bold text-white">
              {product.technicalSpecs.garantiaFabrica}
            </span>
            <span class="text-sm text-slate-400">Garantía fábrica</span>
          </div>
          <div class="bg-white/10 backdrop-blur rounded-xl px-4 py-3 border border-white/20">
            <span class="block text-2xl font-bold text-white">
              {product.installationTime}
            </span>
            <span class="text-sm text-slate-400">Instalación</span>
          </div>
        </div>

        <div class="flex flex-wrap gap-4">
          <a href="tel:934850085" class="inline-flex items-center gap-2 bg-green-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-green-500 transition">
            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 0 0 2.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 0 1-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 0 0-1.091-.852H4.5A2.25 2.25 0 0 0 2.25 4.5v2.25Z" />
            </svg>
            934 850 085
          </a>
          <a href="mailto:ventas@disstands.com" class="inline-flex items-center gap-2 bg-white/10 text-white px-6 py-3 rounded-xl font-bold hover:bg-white/20 transition border border-white/20">
            Pedir presupuesto
          </a>
        </div>
      </div>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-12">

    <!-- Descripción + Casos de uso -->
    <section class="grid lg:grid-cols-2 gap-12 mb-16">
      <div>
        <h2 class="text-2xl font-bold text-slate-900 mb-4">¿Qué es?</h2>
        <p class="text-lg text-slate-600 leading-relaxed mb-6">
          {product.description}
        </p>
        
        <h3 class="text-xl font-bold text-slate-900 mb-4">Aplicaciones</h3>
        <ul class="space-y-2">
          {product.useCases.map((useCase) => (
            <li class="flex items-start gap-3">
              <svg class="w-5 h-5 text-green-600 mt-0.5 shrink-0" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
              </svg>
              <span class="text-slate-700">{useCase}</span>
            </li>
          ))}
        </ul>
      </div>

      <div>
        <h3 class="text-xl font-bold text-slate-900 mb-4">Beneficios principales</h3>
        <div class="space-y-4">
          {product.benefits.map((benefit) => (
            <div class="flex items-start gap-4 bg-green-50 border border-green-100 rounded-xl p-4">
              <span class="w-8 h-8 bg-green-600 rounded-lg flex items-center justify-center shrink-0">
                <svg class="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5" />
                </svg>
              </span>
              <span class="text-slate-700">{benefit}</span>
            </div>
          ))}
        </div>
      </div>
    </section>

    <!-- Especificaciones técnicas -->
    <section class="mb-16">
      <h2 class="text-2xl font-bold text-slate-900 mb-6">Especificaciones técnicas</h2>
      <div class="bg-slate-50 rounded-2xl border border-slate-200 overflow-hidden">
        <div class="grid sm:grid-cols-2 lg:grid-cols-4 divide-y sm:divide-y-0 sm:divide-x divide-slate-200">
          <div class="p-6">
            <span class="text-sm text-slate-500 block mb-1">Altura de fibra</span>
            <span class="text-xl font-bold text-slate-900">{product.technicalSpecs.altura}</span>
          </div>
          <div class="p-6">
            <span class="text-sm text-slate-500 block mb-1">Peso</span>
            <span class="text-xl font-bold text-slate-900">{product.technicalSpecs.peso}</span>
          </div>
          <div class="p-6">
            <span class="text-sm text-slate-500 block mb-1">Densidad</span>
            <span class="text-xl font-bold text-slate-900">{product.technicalSpecs.densidad}</span>
          </div>
          <div class="p-6">
            <span class="text-sm text-slate-500 block mb-1">Drenaje</span>
            <span class="text-xl font-bold text-slate-900">{product.technicalSpecs.drenaje}</span>
          </div>
        </div>
        <div class="border-t border-slate-200 grid sm:grid-cols-2 lg:grid-cols-4 divide-y sm:divide-y-0 sm:divide-x divide-slate-200">
          <div class="p-6">
            <span class="text-sm text-slate-500 block mb-1">Material</span>
            <span class="text-lg font-semibold text-slate-900">{product.technicalSpecs.material}</span>
          </div>
          <div class="p-6">
            <span class="text-sm text-slate-500 block mb-1">Resistencia UV</span>
            <span class="text-lg font-semibold text-slate-900">{product.technicalSpecs.resistenciaUV}</span>
          </div>
          <div class="p-6">
            <span class="text-sm text-slate-500 block mb-1">Garantía instalación</span>
            <span class="text-lg font-semibold text-slate-900">{product.technicalSpecs.garantiaInstalacion}</span>
          </div>
          <div class="p-6 flex items-center gap-4">
            {product.technicalSpecs.ignifugo && (
              <span class="bg-red-100 text-red-700 text-xs font-bold px-2 py-1 rounded">Ignífugo</span>
            )}
            {product.technicalSpecs.antiAlergeno && (
              <span class="bg-blue-100 text-blue-700 text-xs font-bold px-2 py-1 rounded">Antialérgeno</span>
            )}
          </div>
        </div>
      </div>
    </section>

    <!-- Ideal para / No recomendado -->
    <section class="grid md:grid-cols-2 gap-8 mb-16">
      <div class="bg-green-50 border border-green-200 rounded-2xl p-6">
        <h3 class="text-xl font-bold text-green-900 mb-4 flex items-center gap-2">
          <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
          </svg>
          Ideal para
        </h3>
        <ul class="space-y-2">
          {product.idealFor.map((item) => (
            <li class="text-green-800 flex items-start gap-2">
              <span class="text-green-600">→</span>
              {item}
            </li>
          ))}
        </ul>
      </div>
      
      <div class="bg-amber-50 border border-amber-200 rounded-2xl p-6">
        <h3 class="text-xl font-bold text-amber-900 mb-4 flex items-center gap-2">
          <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z" />
          </svg>
          No recomendado para
        </h3>
        <ul class="space-y-2">
          {product.notRecommendedFor.map((item) => (
            <li class="text-amber-800 flex items-start gap-2">
              <span class="text-amber-600">→</span>
              {item}
            </li>
          ))}
        </ul>
      </div>
    </section>

    <!-- Proceso de instalación -->
    <section class="mb-16">
      <h2 class="text-2xl font-bold text-slate-900 mb-6">Proceso de instalación</h2>
      <div class="bg-slate-900 rounded-2xl p-8 text-white">
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
          {product.installationSteps.map((step, index) => (
            <div class="flex items-start gap-4">
              <span class="w-8 h-8 bg-green-600 rounded-full flex items-center justify-center text-sm font-bold shrink-0">
                {index + 1}
              </span>
              <span class="text-slate-300 text-sm">{step}</span>
            </div>
          ))}
        </div>
        <div class="mt-8 pt-6 border-t border-white/20 flex items-center justify-between flex-wrap gap-4">
          <div>
            <span class="text-slate-400 text-sm">Tiempo estimado de instalación:</span>
            <span class="text-white font-bold ml-2">{product.installationTime}</span>
          </div>
          <a href="tel:934850085" class="inline-flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-green-500 transition text-sm">
            Solicitar instalación
          </a>
        </div>
      </div>
    </section>

    <!-- Mantenimiento -->
    <section class="mb-16">
      <h2 class="text-2xl font-bold text-slate-900 mb-6">Mantenimiento</h2>
      <div class="grid md:grid-cols-2 gap-8">
        <div>
          <div class="bg-blue-50 border border-blue-200 rounded-xl p-4 mb-4">
            <span class="text-blue-900 font-bold">Frecuencia recomendada:</span>
            <span class="text-blue-700 ml-2">{product.maintenanceFrequency}</span>
          </div>
          <ul class="space-y-3">
            {product.maintenanceDetails.map((detail) => (
              <li class="flex items-start gap-3 text-slate-600">
                <svg class="w-5 h-5 text-blue-500 mt-0.5 shrink-0" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M11.42 15.17 17.25 21A2.652 2.652 0 0 0 21 17.25l-5.877-5.877M11.42 15.17l2.496-3.03c.317-.384.74-.626 1.208-.766M11.42 15.17l-4.655 5.653a2.548 2.548 0 1 1-3.586-3.586l6.837-5.63m5.108-.233c.55-.164 1.163-.188 1.743-.14a4.5 4.5 0 0 0 4.486-6.336l-3.276 3.277a3.004 3.004 0 0 1-2.25-2.25l3.276-3.276a4.5 4.5 0 0 0-6.336 4.486c.091 1.076-.071 2.264-.904 2.95l-.102.085m-1.745 1.437L5.909 7.5H4.5L2.25 3.75l1.5-1.5L7.5 4.5v1.409l4.26 4.26m-1.745 1.437 1.745-1.437m6.615 8.206L15.75 15.75M4.867 19.125h.008v.008h-.008v-.008Z" />
                </svg>
                {detail}
              </li>
            ))}
          </ul>
        </div>
        
        <div class="bg-gradient-to-br from-green-600 to-green-700 rounded-2xl p-6 text-white">
          <h3 class="text-xl font-bold mb-4">Ahorro vs césped natural</h3>
          <dl class="space-y-4">
            <div>
              <dt class="text-green-200 text-sm">Ahorro de agua</dt>
              <dd class="text-2xl font-bold">{product.vsNaturalGrass.waterSavings}</dd>
            </div>
            <div>
              <dt class="text-green-200 text-sm">Ahorro de tiempo</dt>
              <dd class="text-2xl font-bold">{product.vsNaturalGrass.timeSavings}</dd>
            </div>
            <div>
              <dt class="text-green-200 text-sm">Ahorro económico</dt>
              <dd class="text-2xl font-bold">{product.vsNaturalGrass.costSavings}</dd>
            </div>
            <div>
              <dt class="text-green-200 text-sm">Durabilidad</dt>
              <dd class="text-2xl font-bold">{product.vsNaturalGrass.durability}</dd>
            </div>
          </dl>
        </div>
      </div>
    </section>

    <!-- Precios -->
    <section class="mb-16">
      <h2 class="text-2xl font-bold text-slate-900 mb-6">Precios orientativos</h2>
      <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-4">
        <div class="bg-white border border-gray-200 rounded-xl p-5 text-center">
          <span class="text-slate-500 text-sm block mb-2">Material (base)</span>
          <span class="text-3xl font-black text-slate-900">{product.pricing.basePrice}€</span>
          <span class="text-slate-500">/m²</span>
        </div>
        <div class="bg-white border border-gray-200 rounded-xl p-5 text-center">
          <span class="text-slate-500 text-sm block mb-2">Material (premium)</span>
          <span class="text-3xl font-black text-slate-900">{product.pricing.premiumPrice}€</span>
          <span class="text-slate-500">/m²</span>
        </div>
        <div class="bg-white border border-gray-200 rounded-xl p-5 text-center">
          <span class="text-slate-500 text-sm block mb-2">Instalación</span>
          <span class="text-3xl font-black text-slate-900">{product.pricing.installationCost}€</span>
          <span class="text-slate-500">/m²</span>
        </div>
        <div class="bg-green-50 border border-green-200 rounded-xl p-5 text-center">
          <span class="text-green-700 text-sm block mb-2">Ahorro anual</span>
          <span class="text-3xl font-black text-green-700">{product.pricing.savingsVsNatural}€</span>
          <span class="text-green-600">/año</span>
        </div>
      </div>
      <p class="text-slate-500 text-sm mt-4 text-center">
        * Precios orientativos. Solicita presupuesto personalizado sin compromiso.
      </p>
    </section>

    <!-- FAQs -->
    <section class="mb-16">
      <h2 class="text-2xl font-bold text-slate-900 mb-6">Preguntas frecuentes</h2>
      <div class="space-y-4">
        {product.specificFAQs.map((faq) => (
          <details class="bg-white border border-gray-200 rounded-xl p-5 group">
            <summary class="cursor-pointer list-none flex items-start justify-between gap-4">
              <h3 class="font-bold text-slate-900">{faq.q}</h3>
              <svg class="w-5 h-5 text-slate-400 shrink-0 group-open:rotate-180 transition-transform" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
              </svg>
            </summary>
            <p class="text-slate-600 mt-4 leading-relaxed">{faq.a}</p>
          </details>
        ))}
      </div>
    </section>

    <!-- Zonas donde ofrecemos este servicio -->
    {barriosPorDistrito.length > 0 && (
      <section class="mb-16">
        <h2 class="text-2xl font-bold text-slate-900 mb-6">
          Zonas en Barcelona para {product.title.toLowerCase()}
        </h2>
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
          {barriosPorDistrito.map((distrito) => (
            <div class="bg-white border border-gray-200 rounded-xl p-5">
              <h3 class="font-bold text-slate-900 mb-3">{distrito.name}</h3>
              <ul class="space-y-2">
                {distrito.barriosFiltrados.map((barrio) => (
                  <li>
                    <a 
                      href={`/${distrito.slug}/${barrio.slug}`}
                      class="text-slate-600 hover:text-green-600 transition flex items-center gap-2 text-sm"
                    >
                      <svg class="w-4 h-4 text-slate-400" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" />
                      </svg>
                      {barrio.name}
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          ))}
        </div>
      </section>
    )}

    <!-- CTA Final -->
    <section class="bg-slate-900 rounded-2xl p-8 md:p-12 text-center">
      <h2 class="text-2xl md:text-3xl font-bold text-white mb-4">
        ¿Necesitas {product.title.toLowerCase()}?
      </h2>
      <p class="text-slate-300 mb-8 max-w-xl mx-auto">
        Presupuesto personalizado en 24h. Visita técnica gratuita. Garantía de {product.technicalSpecs.garantiaFabrica}.
      </p>
      <div class="flex flex-wrap justify-center gap-4">
        <a href="tel:934850085" class="inline-flex items-center gap-2 bg-green-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-green-500 transition">
          <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 0 0 2.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 0 1-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 0 0-1.091-.852H4.5A2.25 2.25 0 0 0 2.25 4.5v2.25Z" />
          </svg>
          934 850 085
        </a>
        <a href="mailto:ventas@disstands.com" class="inline-flex items-center gap-2 bg-white text-slate-900 px-6 py-3 rounded-xl font-bold hover:bg-gray-100 transition">
          ventas@disstands.com
        </a>
      </div>
    </section>

  </main>

  <!-- Schema markup -->
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "Service",
    "name": product.title,
    "description": product.description,
    "provider": {
      "@type": "LocalBusiness",
      "name": "CespedBCN",
      "telephone": "+34934850085",
      "email": "ventas@disstands.com"
    },
    "areaServed": {
      "@type": "City",
      "name": "Barcelona"
    },
    "offers": {
      "@type": "AggregateOffer",
      "lowPrice": product.pricing.basePrice,
      "highPrice": product.pricing.premiumPrice,
      "priceCurrency": "EUR",
      "unitText": "m²"
    }
  })} />

</Layout>